#!/bin/sh

indent() {
  sed -u 's/^/       /'
}

BUILD_DIR=$1
VENDOR_DIR="vendor"

echo "-----> lepinsk/heroku-test-buildpack"

echo "Setting Python2.7 to default" | indent
PROFILE_PATH_PYTHON="$BUILD_DIR/.profile.d/defaultpython.sh"
PYTHON_SYMLINK_LOCATION="$HOME/vendor/python-bin/python"
mkdir -p $(dirname $PROFILE_PATH_PYTHON)
mkdir -p $(dirname $PYTHON_SYMLINK_LOCATION)
echo 'ln -s $HOME/.apt/usr/bin/python2.7 ./python' >> $PYTHON_SYMLINK_LOCATION
echo 'export PATH="$HOME/vendor/python-bin:$PATH"' >> $PROFILE_PATH_PYTHON

echo "Adding libncurses.so.5 to LIBRARY_PATH" | indent
PROFILE_PATH_LIBNCURSES="$BUILD_DIR/.profile.d/libncurses.sh"
mkdir -p $(dirname $PROFILE_PATH_LIBNCURSES)
echo 'export LD_LIBRARY_PATH="$LD_LIBRARY_PATH:$HOME/.apt/lib/x86_64-linux-gnu"' >> $PROFILE_PATH_LIBNCURSES
